<!-- signup.html - FIXED SELECT BACKGROUND ISSUE -->
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up</title>
    <link rel="stylesheet" href="{% static 'css/auth_style.css' %}">
    <style>
        /* Your existing CSS styles */
        .error-message {
            color: #dc3545;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        .error-message.show {
            display: block;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-input-wrapper {
            position: relative;
        }
        .password-toggle {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
        }
        .validation-rules {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .rule-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }
        .rule-icon {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        .rule-icon.valid {
            color: #28a745;
        }
        .rule-icon.invalid {
            color: #dc3545;
        }
        .rule-icon.pending {
            color: #6c757d;
        }
        
        input.error, select.error {
            border-color: #dc3545 !important;
            box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25) !important;
        }
        input.valid, select.valid {
            border-color: #28a745 !important;
            box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25) !important;
        }

        /* FIX: Select dropdown background icon issue */
        .select-input {
            background-repeat: no-repeat !important;
            background-position: right 10px center !important;
            background-size: 12px !important;
        }

        /* Additional fix for focused/clicked state */
        .select-input:focus,
        .select-input:active {
            background-repeat: no-repeat !important;
            background-position: right 10px center !important;
            background-size: 12px !important;
        }
    </style>
</head>
<body>
    <div class="auth-container">
        <div class="auth-wrapper">
            <div class="auth-side auth-form-side">
                <div class="form-header">
                    <h2>Join Us</h2>
                    <p>Create your account</p>
                </div>
                <!-- Fake hidden fields to trick browser autofill -->
                <div style="display: none;">
                    <input type="text" name="fakeusername">
                    <input type="password" name="fakepassword">
                </div>
                <form method="post" action="{% url 'signup' %}" id="signupForm" class="auth-form" novalidate autocomplete="off">
                    {% csrf_token %}
                    <!-- Username Field -->
                    <div class="form-group">
                        <label for="id_username" class="form-label">Username</label>
                        <div class="form-input-wrapper">
                            <input type="text" 
                                   name="username" 
                                   id="id_username" 
                                   class="form-control {% if form.username.errors %}error{% endif %}"
                                   placeholder="Username"
                                   value="{{ form.username.value|default:'' }}"
                                   autocomplete="username"
                                   required>
                        </div>
                        {% if form.username.errors %}
                            <div class="error-message show">
                                {% for error in form.username.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="error-message" id="usernameError"></div>
                        {% endif %}
                    </div>
                    <!-- Email Field -->
                    <div class="form-group">
                        <label for="id_email" class="form-label">Email Address</label>
                        <div class="form-input-wrapper">
                            <input type="email" 
                                   name="email" 
                                   id="id_email" 
                                   class="form-control {% if form.email.errors %}error{% endif %}"
                                   placeholder="Email"
                                   value="{{ form.email.value|default:'' }}"
                                   autocomplete="email"
                                   required>
                        </div>
                        {% if form.email.errors %}
                            <div class="error-message show">
                                {% for error in form.email.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="error-message" id="emailError"></div>
                        {% endif %}
                    </div>
                    <!-- User Type Field -->
                    <div class="form-group">
                        <label for="id_user_type" class="form-label">User Type</label>
                        <select name="user_type" 
                                id="id_user_type" 
                                class="select-input {% if form.user_type.errors %}error{% endif %}" 
                                autocomplete="off"
                                required>
                            <option value="">Select User Type</option>
                            {% for value, label in form.user_type.field.choices %}
                                {% if value %}
                                    <option value="{{ value }}" {% if form.user_type.value == value %}selected{% endif %}>
                                        {{ label }}
                                    </option>
                                {% endif %}
                            {% endfor %}
                        </select>
                        {% if form.user_type.errors %}
                            <div class="error-message show">
                                {% for error in form.user_type.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="error-message" id="userTypeError"></div>
                        {% endif %}
                    </div>
                    <!-- Password Field -->
                    <div class="form-group">
                        <label for="id_password" class="form-label">Password</label>
                        <div class="form-input-wrapper">
                            <input type="password" 
                                   name="password" 
                                   id="id_password" 
                                   class="form-control {% if form.password.errors %}error{% endif %}"
                                   placeholder="Password"
                                   autocomplete="new-password"
                                   required>
                            <button type="button" class="password-toggle" onclick="togglePassword('id_password')">üëÅÔ∏è</button>
                        </div>
                        {% if form.password.errors %}
                            <div class="error-message show">
                                {% for error in form.password.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="error-message" id="passwordError"></div>
                        {% endif %}
                    </div>
                    <!-- Confirm Password Field -->
                    <div class="form-group">
                        <label for="id_confirm_password" class="form-label">Confirm Password</label>
                        <div class="form-input-wrapper">
                            <input type="password" 
                                   name="confirm_password" 
                                   id="id_confirm_password" 
                                   class="form-control {% if form.confirm_password.errors %}error{% endif %}"
                                   placeholder="Confirm Password"
                                   autocomplete="new-password"
                                   required>
                            <button type="button" class="password-toggle" onclick="togglePassword('id_confirm_password')">üëÅÔ∏è</button>
                        </div>
                        {% if form.confirm_password.errors %}
                            <div class="error-message show">
                                {% for error in form.confirm_password.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="error-message" id="confirmPasswordError"></div>
                        {% endif %}
                    </div>
                    <!-- Password Validation Rules -->
                    <div class="validation-rules" id="passwordRules">
                        <div class="rule-item">
                            <div class="rule-icon pending" id="ruleLength">‚óã</div>
                            <span>At least 8 characters</span>
                        </div>
                        <div class="rule-item">
                            <div class="rule-icon pending" id="ruleUppercase">‚óã</div>
                            <span>One uppercase letter</span>
                        </div>
                        <div class="rule-item">
                            <div class="rule-icon pending" id="ruleNumber">‚óã</div>
                            <span>One number</span>
                        </div>
                        <div class="rule-item">
                            <div class="rule-icon pending" id="ruleSpecial">‚óã</div>
                            <span>One special character (!@#$%)</span>
                        </div>
                    </div>
                    {% if form.non_field_errors %}
                        <div class="error-message show" style="margin-bottom: 20px; display: block;">
                            {{ form.non_field_errors.0 }}
                        </div>
                    {% endif %}
                    <button type="submit" class="submit-btn">Create Account</button>
                </form>
                <div class="auth-toggle">
                    Already have an account? <a href="{% url 'login' %}">Sign in</a>
                </div>
            </div>
            <div class="auth-side auth-info-side">
                <div class="auth-info-content">
                    <h2>Hello, Friend!</h2>
                    <p>Enter your details and start your journey with us today</p>
                    <div class="auth-features">
                        <div class="feature-item">
                            <div class="feature-icon">üîí</div>
                            <span>Secure & Encrypted</span>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">‚ö°</div>
                            <span>Fast & Reliable</span>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">üéØ</div>
                            <span>Easy to Use</span>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">üåç</div>
                            <span>Global Access</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        // Clear autofilled values on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Clear any autofilled values after a short delay
            setTimeout(() => {
                const inputs = document.querySelectorAll('input[type="text"], input[type="email"], input[type="password"]');
                inputs.forEach(input => {
                    // For fresh page loads, clear if it seems autofilled
                    if (input.value && !input.hasAttribute('data-user-input')) {
                        input.value = '';
                    }
                });
            }, 100);
            // Mark fields when user interacts with them
            document.querySelectorAll('input').forEach(input => {
                input.addEventListener('input', function() {
                    this.setAttribute('data-user-input', 'true');
                });
            });
            // Your existing validation code
            const usernameInput = document.getElementById('id_username');
            const emailInput = document.getElementById('id_email');
            const passwordInput = document.getElementById('id_password');
            const confirmPasswordInput = document.getElementById('id_confirm_password');
            if (usernameInput) {
                usernameInput.addEventListener('input', validateUsername);
                usernameInput.addEventListener('blur', validateUsername);
            }
            if (emailInput) {
                emailInput.addEventListener('input', validateEmail);
                emailInput.addEventListener('blur', validateEmail);
            }
            if (passwordInput) {
                passwordInput.addEventListener('input', validatePassword);
                passwordInput.addEventListener('blur', validatePassword);
            }
            if (confirmPasswordInput) {
                confirmPasswordInput.addEventListener('input', validateConfirmPassword);
                confirmPasswordInput.addEventListener('blur', validateConfirmPassword);
            }
        });
        // Rest of your existing JavaScript functions remain the same
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
            input.setAttribute('type', type);
        }
        function validateUsername() {
            const username = this.value;
            const errorElement = document.getElementById('usernameError');
            
            if (username.length === 0) {
                clearError(this, errorElement);
                return;
            }
            if (username.length < 3) {
                showError(this, errorElement, "Username must be at least 3 characters long.");
            } else if (!/^[a-zA-Z0-9_]+$/.test(username)) {
                showError(this, errorElement, "Username can only contain letters, numbers, and underscores.");
            } else {
                clearError(this, errorElement);
            }
        }
        function validateEmail() {
            const email = this.value;
            const errorElement = document.getElementById('emailError');
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            if (email.length === 0) {
                clearError(this, errorElement);
                return;
            }
            if (!emailRegex.test(email)) {
                showError(this, errorElement, "Please enter a valid email address.");
            } else {
                clearError(this, errorElement);
            }
        }
        function validatePassword() {
            const password = this.value;
            const errorElement = document.getElementById('passwordError');
            
            validatePasswordRules(password);
            
            if (password.length === 0) {
                clearError(this, errorElement);
                return;
            }
            if (password.length < 8) {
                showError(this, errorElement, "Password must be at least 8 characters long.");
            } else {
                clearError(this, errorElement);
            }
            const confirmPassword = document.getElementById('id_confirm_password').value;
            if (confirmPassword) {
                validateConfirmPassword.call(document.getElementById('id_confirm_password'));
            }
        }
        function validateConfirmPassword() {
            const confirmPassword = this.value;
            const password = document.getElementById('id_password').value;
            const errorElement = document.getElementById('confirmPasswordError');
            
            if (confirmPassword.length === 0) {
                clearError(this, errorElement);
                return;
            }
            if (password !== confirmPassword) {
                showError(this, errorElement, "Passwords do not match.");
            } else {
                clearError(this, errorElement);
            }
        }
        function validatePasswordRules(password) {
            const rules = {
                length: password.length >= 8,
                uppercase: /[A-Z]/.test(password),
                number: /[0-9]/.test(password),
                special: /[!@#$%]/.test(password)
            };
            updateRuleIcon('ruleLength', rules.length);
            updateRuleIcon('ruleUppercase', rules.uppercase);
            updateRuleIcon('ruleNumber', rules.number);
            updateRuleIcon('ruleSpecial', rules.special);
        }
        function updateRuleIcon(ruleId, isValid) {
            const ruleIcon = document.getElementById(ruleId);
            if (ruleIcon) {
                ruleIcon.className = 'rule-icon ' + (isValid ? 'valid' : 'invalid');
                ruleIcon.textContent = isValid ? '‚úì' : '‚úó';
            }
        }
        function showError(inputElement, errorElement, message) {
            inputElement.classList.add('error');
            inputElement.classList.remove('valid');
            errorElement.textContent = message;
            errorElement.classList.add('show');
        }
        function clearError(inputElement, errorElement) {
            inputElement.classList.remove('error');
            inputElement.classList.add('valid');
            errorElement.textContent = '';
            errorElement.classList.remove('show');
        }
        document.getElementById('signupForm').addEventListener('submit', function(e) {
            let isValid = true;
            const fields = [
                { input: 'id_username', validator: validateUsername },
                { input: 'id_email', validator: validateEmail },
                { input: 'id_password', validator: validatePassword },
                { input: 'id_confirm_password', validator: validateConfirmPassword }
            ];
            fields.forEach(field => {
                const input = document.getElementById(field.input);
                if (input) {
                    field.validator.call(input);
                    const errorElement = document.getElementById(field.input.replace('id_', '') + 'Error');
                    if (errorElement && errorElement.classList.contains('show')) {
                        isValid = false;
                    }
                }
            });
            if (!isValid) {
                e.preventDefault();
                alert('Please fix the errors before submitting.');
            }
        });
    </script>
</body>
</html>